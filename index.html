<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìù ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:"Noto Sans Bengali",sans-serif; margin:0; background:var(--bg); color:var(--text);}
    :root { --bg:#f7f7f9; --card:#fff; --text:#111; --border:#ddd; --accent:#2563eb; }
    [data-theme="dark"] { --bg:#111; --card:#1a1a1a; --text:#fff; --border:#333; --accent:#60a5fa; }
    .container { max-width:960px; margin:auto; padding:20px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; margin-bottom:14px; box-shadow:0 2px 5px rgba(0,0,0,0.08);}
    button { cursor:pointer; margin-left:5px; padding:5px 10px; border-radius:6px; border:1px solid var(--border); background:var(--card); }
    button:hover { opacity:0.9; }
    .list-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    .list-tab { padding:8px 12px; border-radius:8px; border:1px solid var(--border); background:var(--card); cursor:pointer; }
    .list-tab.active { color:#fff; border-color:transparent; }
    .list-tab:nth-child(1).active { background:#2563eb; }   /* ‡¶®‡ßÄ‡¶≤ */
    .list-tab:nth-child(2).active { background:#16a34a; }   /* ‡¶∏‡¶¨‡ßÅ‡¶ú */
    .list-tab:nth-child(3).active { background:#e11d48; }   /* ‡¶≤‡¶æ‡¶≤ */
    .list-tab:nth-child(4).active { background:#9333ea; }   /* ‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø */
    input[type="text"] { padding:8px 10px; border:1px solid var(--border); border-radius:8px; outline:none; width:70%; }
    input[type="text"]:focus { border-color:var(--accent); }
    .task-box { display:flex; align-items:center; justify-content:space-between; padding:10px; border:1px solid var(--border); border-radius:10px; margin-bottom:10px; background:var(--card); }
    .task-title { margin-left:6px; flex-grow:1; }
    .task-title.completed { text-decoration:line-through; opacity:0.7; }
    .task-date { font-size:12px; color:gray; margin-left:30px; }
    /* ‚úÖ Green Header Box */
    .header-box {
  background:#16a34a; 
  color:#fff;
  padding:20px; 
  border-radius:12px; 
  text-align:center; 
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);  /* ‚úÖ Shadow ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
}

    .header-box h2 {
      margin:0;
      font-size:22px;
    }
    .header-box p {
      margin:5px 0 0 0;
      font-size:14px;
      opacity:0.9;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React,{useEffect,useState} from 'https://esm.sh/react@18.3.1';
    import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth,onAuthStateChanged,GoogleAuthProvider,signInWithPopup,signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore,collection,addDoc,doc,deleteDoc,updateDoc,onSnapshot,query,orderBy,serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ‚úÖ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAyZE7srt9ODVr4umkqqzn7mmgCURM4vLA",
      authDomain: "to-do-list-fdcf2.firebaseapp.com",
      databaseURL: "https://to-do-list-fdcf2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "to-do-list-fdcf2",
      storageBucket: "to-do-list-fdcf2.appspot.com",
      messagingSenderId: "851462607587",
      appId: "1:851462607587:web:3b82f5fe257a0b60b22bd6",
      measurementId: "G-P8K1QBKMX6"
    };

    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const db=getFirestore(app);

    // üîò Header
    function Header({user,onSignIn,onSignOut}){
      return React.createElement('div',null,
        React.createElement('div',{className:'header-box'},
          React.createElement('h2',null,"üìù ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ"),
          React.createElement('p',null,"talha.io")
        ),
        user?(
          React.createElement('div',{className:'card'},
            React.createElement('span',null,"üëã "+user.displayName),
            React.createElement('button',{onClick:onSignOut},'Sign Out')
          )
        ):(
          React.createElement('div',{className:'card'},
            React.createElement('button',{onClick:onSignIn},'Google ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®')
          )
        )
      );
    }

    // üåó Theme Toggle
    function ThemeToggle(){
      const toggle=()=>{
        const current=document.body.getAttribute("data-theme")||"light";
        const next=current==="light"?"dark":"light";
        document.body.setAttribute("data-theme",next);
        localStorage.setItem("theme",next);
      };
      useEffect(()=>{
        const saved=localStorage.getItem("theme")||"light";
        document.body.setAttribute("data-theme",saved);
      },[]);
      return React.createElement('button',{onClick:toggle},'üåó ‡¶•‡¶ø‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®');
    }

    // üìë List Tabs
    function ListTabs({lists,active,onSelect,onAdd}){
      return React.createElement('div',{className:'list-tabs'},
        lists.map((l,i)=>React.createElement('button',{
          key:l.id,
          className:'list-tab '+(active===l.id?'active':''),
          onClick:()=>onSelect(l.id)
        },l.name)),
        React.createElement('button',{className:'list-tab',onClick:onAdd},'+ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü')
      );
    }

    // ‚ûï Add Task
    function AddTaskForm({onAdd}){
      const [title,setTitle]=useState('');
      const submit=e=>{
        e.preventDefault();
        if(!title.trim()) return;
        onAdd({title});
        setTitle('');
      };
      return React.createElement('form',{onSubmit:submit,className:'card'},
        React.createElement('input',{type:"text",value:title,onChange:e=>setTitle(e.target.value),placeholder:'‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶'}),
        React.createElement('button',{type:'submit'},'‚ûï Add')
      );
    }

    // üìù Task List
    function TaskList({tasks,onToggle,onDelete}){
      const formatDate=ts=>{
        if(!ts) return "";
        const d=ts.toDate();
        return new Intl.DateTimeFormat('bn-BD',{dateStyle:'full'}).format(d);
      };
      return React.createElement('div',{className:'card'},
        tasks.length?tasks.map(t=>
          React.createElement('div',{key:t.id,className:'task-box'},
            React.createElement('input',{type:'checkbox',checked:t.completed,onChange:()=>onToggle(t)}),
            React.createElement('span',{className:'task-title '+(t.completed?'completed':'' )},t.completed?"‚úÖ "+t.title:t.title),
            React.createElement('div',{className:'task-date'},formatDate(t.createdAt)),
            React.createElement('button',{onClick:()=>onDelete(t)},'‚ùå')
          )
        ):'‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú ‡¶®‡ßá‡¶á'
      );
    }

    // üöÄ App
    function App(){
      const [user,setUser]=useState(null);
      const [lists,setLists]=useState([]);
      const [activeList,setActiveList]=useState(null);
      const [tasks,setTasks]=useState([]);

      useEffect(()=>onAuthStateChanged(auth,u=>{setUser(u)}),[]);

      useEffect(()=>{
        if(user){
          const unsub=onSnapshot(collection(db,'users',user.uid,'lists'),snap=>{
            const data=snap.docs.map(d=>({id:d.id,...d.data()}));
            setLists(data);
            if(!activeList && data.length) setActiveList(data[0].id);
          });
          return unsub;
        }
      },[user]);

      useEffect(()=>{
        if(user&&activeList){
          const q=query(collection(db,'users',user.uid,'lists',activeList,'tasks'),orderBy('createdAt','desc'));
          const unsub=onSnapshot(q,snap=>{
            setTasks(snap.docs.map(d=>({id:d.id,...d.data()})));
          });
          return unsub;
        }
      },[user,activeList]);

      const provider=new GoogleAuthProvider();
      const signIn=()=>signInWithPopup(auth,provider).catch(err=>{alert("Sign-in error:"+err.message);});
      const signOutNow=()=>signOut(auth);

      const addList=async()=>{
        const name=prompt('‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®');
        if(name&&user){
          await addDoc(collection(db,'users',user.uid,'lists'),{name});
        }
      };
      const addTask=async(payload)=>{
        if(user&&activeList){
          await addDoc(collection(db,'users',user.uid,'lists',activeList,'tasks'),{
            title:payload.title,completed:false,createdAt:serverTimestamp()
          });
        }
      };
      const toggleTask=async(task)=>{
        await updateDoc(doc(db,'users',user.uid,'lists',activeList,'tasks',task.id),{completed:!task.completed});
      };
      const deleteTask=async(task)=>{
        await deleteDoc(doc(db,'users',user.uid,'lists',activeList,'tasks',task.id));
      };

      return React.createElement('div',{className:'container'},
        React.createElement(Header,{user,onSignIn:signIn,onSignOut:signOutNow}),
        React.createElement(ThemeToggle),
        user && React.createElement(ListTabs,{lists,active:activeList,onSelect:setActiveList,onAdd:addList}),
        user && activeList && React.createElement(AddTaskForm,{onAdd:addTask}),
        user && activeList && React.createElement(TaskList,{tasks,onToggle:toggleTask,onDelete:deleteTask})
      );
    }

    createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
