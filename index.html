<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üìù ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family:"Noto Sans Bengali",sans-serif;
      margin:0;
      background:var(--bg);
      color:var(--text);
    }
    :root {
      --bg:#f7f7f9;
      --card:#fff;
      --text:#111;
      --border:#ddd;
      --accent:#2563eb;
    }
    [data-theme="dark"] {
      --bg:#111;
      --card:#1a1a1a;
      --text:#fff;
      --border:#333;
      --accent:#60a5fa;
    }
    .container { max-width:960px; margin:auto; padding:20px; }
    .card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      margin-bottom:14px;
      box-shadow:0 2px 5px rgba(0,0,0,0.08);
      color:var(--text);
    }
    .top-bar {
      display:flex; align-items:center; gap:10px; margin-bottom:12px;
    }
    .clock-box {
      padding:8px 12px; border:1px solid var(--border); border-radius:10px;
      background:var(--card); font-weight:600; min-width:120px; text-align:center;
    }
    button {
      cursor:pointer; margin-left:5px; padding:5px 10px; border-radius:6px;
      border:1px solid var(--border); background:var(--card); color:#fff;
    }
    button:hover { opacity:0.9; }
    .theme-btn {
      background:#f59e0b !important; color:#fff !important; border:none; font-weight:600;
    }

    .list-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    .list-tab {
      padding:8px 12px; border-radius:8px; border:1px solid var(--border);
      background:var(--card); cursor:pointer; color:#fff;
    }
    .list-tab.active { color:#fff; border-color:transparent; }
    .list-tab:nth-child(1).active { background:#2563eb; } /* ‡¶®‡ßÄ‡¶≤ */
    .list-tab:nth-child(2).active { background:#16a34a; } /* ‡¶∏‡¶¨‡ßÅ‡¶ú */
    .list-tab:nth-child(3).active { background:#e11d48; } /* ‡¶≤‡¶æ‡¶≤ */
    .list-tab:nth-child(4).active { background:#9333ea; } /* ‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø */

    input[type="text"] {
      padding:8px 10px; border:1px solid var(--border); border-radius:8px;
      outline:none; width:70%;
    }
    input[type="text"]:focus { border-color:var(--accent); }

    .task-box {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px; border:1px solid var(--border); border-radius:10px;
      margin-bottom:10px; background:var(--card);
    }
    .task-title { margin-left:6px; flex-grow:1; }
    .task-title.completed { text-decoration:line-through; opacity:0.7; }
    .task-date { font-size:12px; color:gray; margin-left:30px; }

    .header-box {
      background:#16a34a; color:#fff; padding:20px; border-radius:12px;
      text-align:center; margin-bottom:14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6), 0 0 10px rgba(255,255,255,0.2);
    }
    .header-box h2 { margin:0; font-size:22px; }
    .header-box p { margin:5px 0 0 0; font-size:14px; opacity:0.9; }

    /* Reminder form row */
    .reminder-row {
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-top:10px;
    }
    .reminder-chip {
      padding:6px 10px; border:1px solid var(--border); border-radius:8px;
      background:var(--card);
    }
    .reminder-input {
      width:80px; padding:6px 8px; border:1px solid var(--border); border-radius:8px;
      background:var(--card); color:var(--text);
    }
    .reminder-note { font-size:12px; opacity:0.8; }
    .muted { opacity:0.6; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="module">
    import React,{useEffect,useState,useRef} from 'https://esm.sh/react@18.3.1';
    import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth,onAuthStateChanged,GoogleAuthProvider,signInWithPopup,signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore,collection,addDoc,doc,deleteDoc,updateDoc,onSnapshot,query,orderBy,serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ‚úÖ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAyZE7srt9ODVr4umkqqzn7mmgCURM4vLA",
      authDomain: "to-do-list-fdcf2.firebaseapp.com",
      databaseURL: "https://to-do-list-fdcf2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "to-do-list-fdcf2",
      storageBucket: "to-do-list-fdcf2.appspot.com",
      messagingSenderId: "851462607587",
      appId: "1:851462607587:web:3b82f5fe257a0b60b22bd6",
      measurementId: "G-P8K1QBKMX6"
    };
    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const db=getFirestore(app);

    // üîò Header
    function Header({user,onSignIn,onSignOut}){
      return React.createElement('div',null,
        React.createElement('div',{className:'header-box'},
          React.createElement('h2',null,"üìù ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ"),
          React.createElement('p',null,"talha.io")
        ),
        user?(
          React.createElement('div',{className:'card'},
            React.createElement('span',null,"üëã "+user.displayName),
            React.createElement('button',{onClick:onSignOut},'Sign Out')
          )
        ):(
          React.createElement('div',{className:'card'},
            React.createElement('button',{onClick:onSignIn},'Google ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®')
          )
        )
      );
    }

    // ‚è∞ Digital Clock
    function DigitalClock(){
      const [now,setNow]=useState(new Date());
      useEffect(()=>{
        const t=setInterval(()=>setNow(new Date()),1000);
        return ()=>clearInterval(t);
      },[]);
      const timeStr = new Intl.DateTimeFormat('bn-BD',{ hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false }).format(now);
      return React.createElement('div',{className:'clock-box'}, timeStr);
    }

    // üåó Theme Toggle + Clock Row
    function TopBar(){
      const toggle=()=>{
        const current=document.body.getAttribute("data-theme")||"light";
        const next=current==="light"?"dark":"light";
        document.body.setAttribute("data-theme",next);
        localStorage.setItem("theme",next);
      };
      useEffect(()=>{
        const saved=localStorage.getItem("theme")||"light";
        document.body.setAttribute("data-theme",saved);
      },[]);
      return React.createElement('div',{className:'top-bar'},
        React.createElement('button',{onClick:toggle,className:'theme-btn'},'üåó ‡¶•‡¶ø‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®'),
        React.createElement(DigitalClock,null)
      );
    }

    // üìë List Tabs
    function ListTabs({lists,active,onSelect,onAdd}){
      return React.createElement('div',{className:'list-tabs'},
        lists.map((l)=>React.createElement('button',{
          key:l.id,
          className:'list-tab '+(active===l.id?'active':''),
          onClick:()=>onSelect(l.id)
        },l.name)),
        React.createElement('button',{className:'list-tab',onClick:onAdd},'+ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü')
      );
    }

    // ‚ûï Add Task (with optional Reminder)
    function AddTaskForm({onAdd}){
      const [title,setTitle]=useState('');
      const [wantReminder,setWantReminder]=useState(false);
      const [hrs,setHrs]=useState('');
      const [mins,setMins]=useState('');
      const [secs,setSecs]=useState('');

      const submit= e =>{
        e.preventDefault();
        const trimmed = title.trim();
        if(!trimmed) return;

        let delayMs = null;
        if(wantReminder){
          const h = Math.max(0, parseInt(hrs||'0',10)||0);
          const m = Math.max(0, parseInt(mins||'0',10)||0);
          const s = Math.max(0, parseInt(secs||'0',10)||0);
          delayMs = (h*3600 + m*60 + s) * 1000;
          if(delayMs<=0){ delayMs = null; }
        }

        onAdd({ title:trimmed, delayMs });
        setTitle('');
        setHrs(''); setMins(''); setSecs(''); setWantReminder(false);
      };

      return React.createElement('form',{onSubmit:submit,className:'card'},
        React.createElement('input',{
          type:"text", value:title, onChange:e=>setTitle(e.target.value),
          placeholder:'‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶'
        }),
        React.createElement('button',{type:'submit'},'‚ûï Add'),

        React.createElement('div',{className:'reminder-row'},
          React.createElement('label',{className:'reminder-chip'},
            React.createElement('input',{
              type:'checkbox',
              checked:wantReminder,
              onChange:e=>setWantReminder(e.target.checked)
            }),
            ' ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶¶‡ßá‡¶¨?'
          ),
          React.createElement('input',{
            className:'reminder-input',
            type:'number', min:'0', placeholder:'‡¶ò‡¶®‡ßç‡¶ü‡¶æ',
            value:hrs, onChange:e=>setHrs(e.target.value),
            disabled:!wantReminder
          }),
          React.createElement('input',{
            className:'reminder-input',
            type:'number', min:'0', placeholder:'‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü',
            value:mins, onChange:e=>setMins(e.target.value),
            disabled:!wantReminder
          }),
          React.createElement('input',{
            className:'reminder-input',
            type:'number', min:'0', placeholder:'‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°',
            value:secs, onChange:e=>setSecs(e.target.value),
            disabled:!wantReminder
          }),
          React.createElement('span',{className:'reminder-note '+(!wantReminder?'muted':'')},
            wantReminder ? '‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶¶‡¶ø‡¶≤‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Ü‡¶∏‡¶¨‡ßá' : '‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶ü‡¶ø‡¶ï ‡¶¶‡¶ø‡¶¨‡ßá ‡¶®‡¶æ'
          )
        )
      );
    }

    // üìù Task List
    function TaskList({tasks,onToggle,onDelete}){
      const formatDate=ts=>{
        if(!ts) return "";
        const d=ts.toDate();
        return new Intl.DateTimeFormat('bn-BD',{dateStyle:'full'}).format(d);
      };
      return React.createElement('div',{className:'card'},
        tasks.length?tasks.map(t=>
          React.createElement('div',{key:t.id,className:'task-box'},
            React.createElement('input',{type:'checkbox',checked:t.completed,onChange:()=>onToggle(t)}),
            React.createElement('span',{className:'task-title '+(t.completed?'completed':'' )},t.completed?"‚úÖ "+t.title:t.title),
            React.createElement('div',{className:'task-date'},
              formatDate(t.createdAt), t.reminderAt ? ' ‚Ä¢ üîî' : ''
            ),
            React.createElement('button',{onClick:()=>onDelete(t)},'‚ùå')
          )
        ):'‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú ‡¶®‡ßá‡¶á'
      );
    }

    // üîî Local Notification helper
    function requestNotifyPermission(){
      if(!('Notification' in window)) return false;
      if(Notification.permission === 'granted') return true;
      if(Notification.permission === 'denied') return false;
      Notification.requestPermission();
      return Notification.permission === 'granted';
    }
    function scheduleLocalReminder(title, delayMs){
      if(!('Notification' in window)) return;
      if(Notification.permission !== 'granted'){
        // Try requesting once
        Notification.requestPermission().then(p=>{
          if(p==='granted'){
            if(delayMs!=null){
              setTimeout(()=> new Notification('üîî ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞', { body: '‡¶Æ‡¶®‡ßá ‡¶ï‡¶∞: '+title }), delayMs);
            }
          }
        });
        return;
      }
      if(delayMs!=null){
        setTimeout(()=> new Notification('üîî ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞', { body: '‡¶Æ‡¶®‡ßá ‡¶ï‡¶∞: '+title }), delayMs);
      }
    }

    // üöÄ App
    function App(){
      const [user,setUser]=useState(null);
      const [lists,setLists]=useState([]);
      const [activeList,setActiveList]=useState(null);
      const [tasks,setTasks]=useState([]);

      useEffect(()=>onAuthStateChanged(auth,u=>{setUser(u)}),[]);
      useEffect(()=>{
        if(user){
          const unsub=onSnapshot(collection(db,'users',user.uid,'lists'),snap=>{
            const data=snap.docs.map(d=>({id:d.id,...d.data()}));
            setLists(data);
            if(!activeList && data.length) setActiveList(data[0].id);
          });
          return unsub;
        }
      },[user]);

      useEffect(()=>{
        if(user&&activeList){
          const q=query(collection(db,'users',user.uid,'lists',activeList,'tasks'),orderBy('createdAt','desc'));
          const unsub=onSnapshot(q,snap=>{
            setTasks(snap.docs.map(d=>({id:d.id,...d.data()})));
          });
          return unsub;
        }
      },[user,activeList]);

      const provider=new GoogleAuthProvider();
      const signIn=()=>signInWithPopup(auth,provider).catch(err=>{alert("Sign-in error:"+err.message);});
      const signOutNow=()=>signOut(auth);

      const addList=async()=>{
        const name=prompt('‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®');
        if(name&&user){
          await addDoc(collection(db,'users',user.uid,'lists'),{name});
        }
      };

      const addTask=async(payload)=>{
        const { title, delayMs } = payload;
        if(user&&activeList){
          const data = {
            title, completed:false, createdAt:serverTimestamp()
          };
          if(delayMs!=null){
            data.reminderAt = new Date(Date.now()+delayMs).toISOString(); // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
          }
          const ref = await addDoc(collection(db,'users',user.uid,'lists',activeList,'tasks'), data);

          // Local reminder schedule (tab alive ‡¶•‡¶æ‡¶ï‡¶≤‡ßá)
          if(delayMs!=null){
            scheduleLocalReminder(title, delayMs);
          }
        }
      };

      const toggleTask=async(task)=>{
        await updateDoc(doc(db,'users',user.uid,'lists',activeList,'tasks',task.id),{completed:!task.completed});
      };

      const deleteTask=async(task)=>{
        await deleteDoc(doc(db,'users',user.uid,'lists',activeList,'tasks',task.id));
      };

      return React.createElement('div',{className:'container'},
        React.createElement(Header,{user,onSignIn:signIn,onSignOut:signOutNow}),
        React.createElement(TopBar,null),
        user && React.createElement(ListTabs,{lists,active:activeList,onSelect:setActiveList,onAdd:addList}),
        user && activeList && React.createElement(AddTaskForm,{onAdd:addTask}),
        user && activeList && React.createElement(TaskList,{tasks,onToggle:toggleTask,onDelete:deleteTask})
      );
    }
    createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
