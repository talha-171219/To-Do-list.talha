<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bangla To-Do</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: "Noto Sans Bengali", sans-serif; margin:0; background: var(--bg); color: var(--text);}
    :root { --bg:#f7f7f9; --card:#fff; --text:#111; --border:#ddd; --accent:#2563eb; }
    [data-theme="dark"] { --bg:#111; --card:#1a1a1a; --text:#eee; --border:#333; --accent:#60a5fa; }
    .container { max-width:960px; margin:auto; padding:20px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; margin-bottom:14px; }
    button { cursor:pointer; margin-left:5px;}
    .list-tabs { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    .list-tab { padding:8px 12px; border-radius:8px; border:1px solid var(--border); background:var(--card); }
    .list-tab.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, {useEffect, useState} from 'https://esm.sh/react@18.3.1';
    import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, deleteDoc, updateDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ✅ তোমার Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAyZE7srt9ODVr4umkqqzn7mmgCURM4vLA",
      authDomain: "to-do-list-fdcf2.firebaseapp.com",
      databaseURL: "https://to-do-list-fdcf2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "to-do-list-fdcf2",
      storageBucket: "to-do-list-fdcf2.appspot.com",
      messagingSenderId: "851462607587",
      appId: "1:851462607587:web:3b82f5fe257a0b60b22bd6",
      measurementId: "G-P8K1QBKMX6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Header
    function Header({user,onSignIn,onSignOut}){
      return (
        React.createElement('div',{className:'card'},
          user ? (
            React.createElement('div',null,
              React.createElement('span',null,"👋 " + user.displayName),
              React.createElement('button',{onClick:onSignOut},'Sign Out')
            )
          ) : (
            React.createElement('button',{onClick:onSignIn},'Google দিয়ে সাইন ইন')
          )
        )
      );
    }

    function ListTabs({lists,active,onSelect,onAdd}){
      return React.createElement('div',{className:'list-tabs'},
        lists.map(l=> React.createElement('button',{key:l.id,className:'list-tab '+(active===l.id?'active':''),onClick:()=>onSelect(l.id)},l.name)),
        React.createElement('button',{className:'list-tab',onClick:onAdd},'+ লিস্ট')
      );
    }

    function AddTaskForm({onAdd}){
      const [title,setTitle]=useState('');
      const submit=e=>{
        e.preventDefault();
        if(!title.trim()) return;
        onAdd({title});
        setTitle('');
      };
      return React.createElement('form',{onSubmit:submit,className:'card'},
        React.createElement('input',{value:title,onChange:e=>setTitle(e.target.value),placeholder:'কাজ যোগ করুন…'}),
        React.createElement('button',{type:'submit'},'Add')
      );
    }

    function TaskList({tasks,onToggle,onDelete}){
      return React.createElement('div',{className:'card'},
        tasks.length? tasks.map(t=>React.createElement('div',{key:t.id},
          React.createElement('input',{type:'checkbox',checked:t.completed,onChange:()=>onToggle(t)}),
          React.createElement('span',null,t.title),
          React.createElement('button',{onClick:()=>onDelete(t)},'❌')
        )): 'কোনো কাজ নেই'
      );
    }

    function App(){
      const [user,setUser]=useState(null);
      const [lists,setLists]=useState([]);
      const [activeList,setActiveList]=useState(null);
      const [tasks,setTasks]=useState([]);

      useEffect(()=> onAuthStateChanged(auth,u=>{setUser(u)}),[]);

      useEffect(()=>{
        if(user){
          const unsub=onSnapshot(collection(db,'users',user.uid,'lists'),snap=>{
            const data=snap.docs.map(d=>({id:d.id,...d.data()}));
            setLists(data);
            if(!activeList && data.length) setActiveList(data[0].id);
          });
          return unsub;
        }
      },[user]);

      useEffect(()=>{
        if(user && activeList){
          const q=query(collection(db,'users',user.uid,'lists',activeList,'tasks'),orderBy('createdAt','desc'));
          const unsub=onSnapshot(q,snap=>{
            setTasks(snap.docs.map(d=>({id:d.id,...d.data()})));
          });
          return unsub;
        }
      },[user,activeList]);

      const provider = new GoogleAuthProvider();
      const signIn=()=> {
        signInWithPopup(auth, provider)
          .then(result=> console.log("Signed in:", result.user.displayName))
          .catch(err=> { console.error(err); alert("Sign-in error: "+err.message); });
      };
      const signOutNow=()=> signOut(auth);

      const addList=async()=>{
        const name=prompt('লিস্ট নাম দিন');
        if(name&&user){
          await addDoc(collection(db,'users',user.uid,'lists'),{name});
        }
      };

      const addTask=async(payload)=>{
        if(user&&activeList){
          await addDoc(collection(db,'users',user.uid,'lists',activeList,'tasks'),{
            title:payload.title,completed:false,createdAt:serverTimestamp()
          });
        }
      };
      const toggleTask=async(task)=>{
        await updateDoc(doc(db,'users',user.uid,'lists',activeList,'tasks',task.id),{completed:!task.completed});
      };
      const deleteTask=async(task)=>{
        await deleteDoc(doc(db,'users',user.uid,'lists',activeList,'tasks',task.id));
      };

      return React.createElement('div',{className:'container'},
        React.createElement(Header,{user,onSignIn:signIn,onSignOut:signOutNow}),
        user && React.createElement(ListTabs,{lists,active:activeList,onSelect:setActiveList,onAdd:addList}),
        user && activeList && React.createElement(AddTaskForm,{onAdd:addTask}),
        user && activeList && React.createElement(TaskList,{tasks,onToggle:toggleTask,onDelete:deleteTask})
      );
    }

    createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>

